<?php
//////////////////////////////////////////////////////////////////////////////
// AITK維基專用元件
//////////////////////////////////////////////////////////////////////////////
namespace AITK                                                               ;
use MatthiasMullie\Minify as Minify                                          ;
//////////////////////////////////////////////////////////////////////////////
class Wiki                                                                   {
//////////////////////////////////////////////////////////////////////////////
// 產生亂數
//////////////////////////////////////////////////////////////////////////////
public static function RandomString ( $PREFIX , $LENGTH                    ) {
  ////////////////////////////////////////////////////////////////////////////
  $L      = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz" ;
  $S      = $PREFIX                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  while                             ( strlen ( $S ) < $LENGTH              ) {
    //////////////////////////////////////////////////////////////////////////
    $I    = rand                    ( 0  , 61                              ) ;
    $T    = substr                  ( $L , $I , 1                          ) ;
    $S    = "{$S}{$T}"                                                       ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return $S                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 取得關鍵字內容
//////////////////////////////////////////////////////////////////////////////
public static function GetTag ( $KEY , $TAGs                               ) {
  ////////////////////////////////////////////////////////////////////////////
  $K     = array_keys         ( $TAGs                                      ) ;
  $M     = strtolower         ( $KEY                                       ) ;
  foreach                     ( $K as $L                                   ) {
    $S   = strtolower         ( $L                                         ) ;
    if                        ( $S == $M                                   ) {
      return $TAGs [ $L ]                                                    ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return ""                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 取得函數
//////////////////////////////////////////////////////////////////////////////
public static function GetFunction ( $argv , $Maps                         ) {
  ////////////////////////////////////////////////////////////////////////////
  $func = self::GetTag             ( "function" , $argv                    ) ;
  if                               ( strlen ( $func ) <= 0                 ) {
    return ""                                                                ;
  }                                                                          ;
  $func = strtolower               ( $func                                 ) ;
  ////////////////////////////////////////////////////////////////////////////
  if                               ( ! array_key_exists ( $func , $Maps )  ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return $Maps [ $func ]                                                     ;
}
//////////////////////////////////////////////////////////////////////////////
// AITK參數
//////////////////////////////////////////////////////////////////////////////
public static function GetVariables ( $args , $argv , $Options             ) {
  ////////////////////////////////////////////////////////////////////////////
  if                                ( $args < 2                            ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $KEY         = $argv [ 1 ]                                                 ;
  $KEY         = strtolower         ( $KEY                                 ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                            ( $KEY                                 ) {
    //////////////////////////////////////////////////////////////////////////
    case "options"                                                           :
    return json_encode              ( $Options                             ) ;
    //////////////////////////////////////////////////////////////////////////
    case "site"                                                              :
      $IDX     = 2                                                           ;
      $OPT     = $Options                                                    ;
      while                         ( $IDX < $args                         ) {
        $K     = $argv [ $IDX ]                                              ;
        if                          ( is_array ( $OPT )                    ) {
          if                        ( ! array_key_exists ( $K , $OPT )     ) {
            return ""                                                        ;
          }                                                                  ;
        } else                                                               {
          return ""                                                          ;
        }                                                                    ;
        $OPT   = $OPT [ $K ]                                                 ;
        $IDX   = $IDX + 1                                                    ;
      }                                                                      ;
      if                            ( is_array ( $OPT )                    ) {
        return json_encode          ( $OPT                                 ) ;
      }                                                                      ;
    return $OPT                                                              ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return ""                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// Astrophysics參數
//////////////////////////////////////////////////////////////////////////////
public static function GetAstrophysics ( $args , $argv , $Options          ) {
  ////////////////////////////////////////////////////////////////////////////
  if                                   ( $args < 2                         ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $KEY         = $argv [ 1 ]                                                 ;
  $KEY         = strtolower            ( $KEY                              ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                               ( $KEY                              ) {
    //////////////////////////////////////////////////////////////////////////
    case "constant"                                                          :
    return ""                                                                ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return ""                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 錯誤參數
//////////////////////////////////////////////////////////////////////////////
public static function InvalidOptions ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $JSOX = json_encode                 ( $argv                              ) ;
  return "Invalid parameters : [ {$JSOX} ] - | {$Content} |"                 ;
}
//////////////////////////////////////////////////////////////////////////////
// 取得資料庫
//////////////////////////////////////////////////////////////////////////////
public static function GetCurrentDB  ( $argv , $Options                    ) {
  ////////////////////////////////////////////////////////////////////////////
  $DB          = $Options            [ "Database"                          ] ;
  $Databases   = $Options            [ "Databases"                         ] ;
  ////////////////////////////////////////////////////////////////////////////
  $DBN         = self::GetTag        ( "database" , $argv                  ) ;
  if                                 ( strlen ( $DBN ) > 0                 ) {
    if ( array_key_exists ( $DBN , $Databases )                            ) {
      $DB      = $Databases          [ $DBN                                ] ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return $DB                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// 取得資料庫表格名稱
//////////////////////////////////////////////////////////////////////////////
public static function GetAssignTable ( $DefaultTable , $argv , $Options   ) {
  ////////////////////////////////////////////////////////////////////////////
  $TAB   = $DefaultTable                                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $TBN   = self::GetTag               ( "table" , $argv                    ) ;
  if                                  ( strlen ( $TBN ) > 0                ) {
    $TAB = $TBN                                                              ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return $TAB                                                                ;
}
//////////////////////////////////////////////////////////////////////////////
public static function WildAJAX  ( $DB , $PICKDB , $HH , $AA , $Options    ) {
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Answer" ] = "No"                                                    ;
  ////////////////////////////////////////////////////////////////////////////
  if                             ( ! $HH -> hasParameter ( "Method"   )    ) {
    return $AA                                                               ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $METHOD     = $HH -> Parameter ( "Method"                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                         ( $METHOD                                 ) {
    case "Function"                                                          :
      ////////////////////////////////////////////////////////////////////////
      if                         ( ! $HH -> hasParameter ( "Function" )    ) {
        return $AA                                                           ;
      }                                                                      ;
      ////////////////////////////////////////////////////////////////////////
      $FX     = $HH -> Parameter ( "Function"                              ) ;
      if                         ( strlen ( $FX ) > 0                      ) {
        if                       ( method_exists ( "\AITK\Wiki" , $FX )    ) {
          $AA = self::$FX        ( $DB , $PICKDB , $HH , $AA , $Options    ) ;
        }                                                                    ;
      }                                                                      ;
      ////////////////////////////////////////////////////////////////////////
    break                                                                    ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// 輸出XML
//////////////////////////////////////////////////////////////////////////////
public static function ExportXML  ( $argv , $Content , $Options            ) {
  ////////////////////////////////////////////////////////////////////////////
  return $Content                                                            ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 輸出HTML
//////////////////////////////////////////////////////////////////////////////
public static function ExportHTML ( $argv , $Content , $Options            ) {
  ////////////////////////////////////////////////////////////////////////////
  $TAG          = ""                                                         ;
  $PARAMETERS   = ""                                                         ;
  $NOTAIL       = 0                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $C            = array           (                                        ) ;
  $K            = array_keys      ( $argv                                  ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                         ( $K as $L                               ) {
    $S          = strtolower      ( $L                                     ) ;
    if                            ( $S == "function"                       ) {
    } else
    if                            ( $S == "tag"                            ) {
      $TAG      = $argv [ $L ]                                               ;
    } else
    if                            ( $S == "notail"                         ) {
      $V        = $argv [ $L ]                                               ;
      if                          ( strlen ( $V ) <= 0                     ) {
        $NOTAIL = 1                                                          ;
      } else                                                                 {
        $NOTAIL = $V                                                         ;
      }                                                                      ;
    } else                                                                   {
      $V        = $argv [ $L ]                                               ;
      $P        = "{$L}=\"{$V}\""                                            ;
      array_push                  ( $C , $P                                ) ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                              ( count ( $C ) > 0                       ) {
    $PARAMETERS = implode         ( " " , $C                               ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                              ( strlen ( $TAG ) <= 0                   ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                              ( $NOTAIL > 0                            ) {
    return "<{$TAG} {$PARAMETERS} />"                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return   "<{$TAG} {$PARAMETERS}>{$Content}</{$TAG}>"                       ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 輸出JSON
//////////////////////////////////////////////////////////////////////////////
public static function ExportJSON ( $argv , $Content , $Options            ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode              ( $argv                                  ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 輸出設定值
//////////////////////////////////////////////////////////////////////////////
public static function ExportOptions ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 引入模組
//////////////////////////////////////////////////////////////////////////////
public static function IncludeModule ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Module   = self::GetTag           ( "name"   , $argv                    ) ;
  if ( ! array_key_exists ( "Modules" , $Options )                         ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $LOCALE   = self::GetTag           ( "locale" , $argv                    ) ;
  if                                 ( strlen ( $LOCALE ) <= 0             ) {
    $LOCALE = "zh_TW"                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PATHs  = $Options [ "Modules" ]                                           ;
  if ( ! array_key_exists ( $Module , $PATHs )                             ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $EXTENSION = $Options [ "AITK"      ]                                      ;
  $PATHX     = $Options [ "Extension" ]                                      ;
  $FILENAME  = $PATHs   [ $Module     ]                                      ;
  $FILENAME  = "{$PATHX}/{$FILENAME}"                                        ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS [ "$(EXTENSION-PATH)"   ] = $EXTENSION                               ;
  $MAPS [ "$(EXTENSION-LOCALE)" ] = $LOCALE                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys  ( $FILENAME , $MAPS                   ) ;
}
//////////////////////////////////////////////////////////////////////////////
// +| ReadFile |+
// 讀取檔案
//////////////////////////////////////////////////////////////////////////////
public static function ReadFile    ( $DB , $PICKDB , $HH , $AA , $Options  ) {
  ////////////////////////////////////////////////////////////////////////////
  $FILENAME  = $HH -> Parameter    ( "Filename"                            ) ;
  $TEXT      = file_get_contents   ( $FILENAME                             ) ;
  if                               ( ! $TEXT                               ) {
    $TEXT    = ""                                                            ;
  }                                                                          ;
  $AA [ "Message" ] = $TEXT                                                  ;
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| ReadFile |-
//////////////////////////////////////////////////////////////////////////////
// +| WriteFile |+
// 寫入檔案
//////////////////////////////////////////////////////////////////////////////
public static function WriteFile   ( $DB , $PICKDB , $HH , $AA , $Options  ) {
  ////////////////////////////////////////////////////////////////////////////
  $TEXT      = $HH -> Parameter    ( "Text"                                ) ;
  $FILENAME  = $HH -> Parameter    ( "Filename"                            ) ;
  ////////////////////////////////////////////////////////////////////////////
  $fhandle   = fopen               ( $FILENAME , "w+"                      ) ;
  fwrite                           ( $fhandle  , $TEXT                     ) ;
  fclose                           ( $fhandle                              ) ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| WriteFile |-
//////////////////////////////////////////////////////////////////////////////
// +| FileEditorUI |+
// 檔案編輯器
//////////////////////////////////////////////////////////////////////////////
public static function FileEditorUI  ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Id          = self::GetTag        ( "id"        , $argv                 ) ;
  $Filename    = self::GetTag        ( "filename"  , $argv                 ) ;
  $Directory   = self::GetTag        ( "directory" , $argv                 ) ;
  $Original    = $Filename                                                   ;
  $Label       = "Update"                                                    ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options            [ "Templates"                         ] ;
  $DIRs        = $Options            [ "Directory"                         ] ;
  ////////////////////////////////////////////////////////////////////////////
  if ( ! array_key_exists ( $Directory , $DIRs ) )                           {
    $Directory = "Default"                                                   ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DIRPATH     = $DIRs               [ $Directory                          ] ;
  $LOCALFILE   = "{$DIRPATH}/{$Filename}"                                    ;
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Content ) > 0             ) {
    $Original  = $Content                                                    ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Id ) <= 0                 ) {
    $Id        = self::RandomString  ( "File-" , 24                        ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $EXTENSION   = $Options            [ "AITK"                              ] ;
  $PATHX       = $Options            [ "Extension"                         ] ;
  $TEMPLFILE   = $Templates          [ "File::Editor"                      ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $READONLY    = ""                                                          ;
  $PARAMETERS  = array               (                                     ) ;
  $KEYs        = array_keys          ( $argv                               ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                            ( $KEYs as $K                         ) {
    //////////////////////////////////////////////////////////////////////////
    $S         = strtolower          ( $K                                  ) ;
    //////////////////////////////////////////////////////////////////////////
    switch                           ( $S                                  ) {
      case "function"                                                        :
      case "id"                                                              :
      case "filename"                                                        :
      case "directory"                                                       :
      break                                                                  ;
      case "label"                                                           :
        $Label = self::GetTag        ( $K , $argv                          ) ;
      break                                                                  ;
      case "readonly"                                                        :
        $RO    = self::GetTag        ( $K , $argv                          ) ;
        $RO    = strtolower          ( $RO                                 ) ;
        if ( ( strlen ( $RO ) <= 0 )                                        ||
             ( in_array ( $RO , [ "true" , "yes" ] ) )                     ) {
          $READONLY = "display: none;"                                       ;
        }                                                                    ;
      default                                                                :
        $V     = self::GetTag        ( $K , $argv                          ) ;
        array_push                   ( $PARAMETERS , "{$K}='{$V}'"         ) ;
      break                                                                  ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARMS       = ""                                                          ;
  if                                 ( count ( $PARAMETERS ) > 0           ) {
    $PARMS     = implode             ( " " , $PARAMETERS                   ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(EDITOR-ID)"           =>   $Id                                        ,
    "$(BUTTON-LABEL)"        =>   $Label                                     ,
    "$(EDITOR-LABEL)"        =>   $Original                                  ,
    "$(EDITOR-PARAMETERS)"   =>   $PARMS                                     ,
    "$(EDITOR-DIRECTORY)"    =>   $Directory                                 ,
    "$(EDITOR-PATH)"         =>   $DIRPATH                                   ,
    "$(EDITOR-FILENAME)"     =>   $Filename                                  ,
    "$(EDITOR-LOCALFILE)"    =>   $LOCALFILE                                 ,
    "$(EDITOR-READONLY)"     =>   $READONLY                                  ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys  ( $TEMPLFILE , $MAPS                  ) ;
}
//////////////////////////////////////////////////////////////////////////////
// -| FileEditorUI |-
//////////////////////////////////////////////////////////////////////////////
// 參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsEditorDB   ( $DB                              ,
                                            $argv                            ,
                                            $Content                         ,
                                            $Options                       ) {
  ////////////////////////////////////////////////////////////////////////////
  $ID          = self::GetTag             ( "id"       , $argv             ) ;
  if                                      ( strlen ( $ID ) <= 0            ) {
    $ID        = self::RandomString       ( "SettingsEditor-"  , 40        ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PICKDB      = self::GetTag             ( "database" , $argv             ) ;
  $Edit        = self::GetTag             ( "editable" , $argv             ) ;
  $SEZTAB      = self::GetAssignTable     ( "`settings`"                     ,
                                            $argv                            ,
                                            $Options                       ) ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options                 [ "Templates"                    ] ;
  $EXTENSION   = $Options                 [ "AITK"                         ] ;
  $PATHX       = $Options                 [ "Extension"                    ] ;
  $TEMPLFILE   = $Templates               [ "Settings::Editor"             ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMFILE    = $Templates               [ "Settings::Item"               ] ;
  $ITEMFILE    = "{$PATHX}/{$ITEMFILE}"                                      ;
  $TEMPL       = file_get_contents        ( $ITEMFILE                      ) ;
  ////////////////////////////////////////////////////////////////////////////
  $Edit        = strtolower               ( $Edit                          ) ;
  $EDITX       = true                                                        ;
  $Editing     =                          [ "false" , "no" ,"0"            ] ;
  if                                      ( in_array ( $Edit , $Editing )  ) {
    $EDITX     = false                                                       ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                      ( $EDITX                         ) {
    $EDITABLE  = ""                                                          ;
    $READONLY  = "display: none;"                                            ;
  } else                                                                     {
    $EDITABLE  = "display: none;"                                            ;
    $READONLY  = ""                                                          ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMS       = array                    (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $QQ          = "select `id`,`username`,`scope`,`keyword`,`value`"          .
                 " from {$SEZTAB} order by `id` asc ;"                       ;
  $qq          = $DB -> Query             ( $QQ                            ) ;
  if                                      ( $DB -> hasResult ( $qq )       ) {
    while ( $rr = $qq -> fetch_array ( MYSQLI_BOTH )                       ) {
      $MAPX    = array                                                       (
        "$(EXTENSION-PATH)"      =>   $EXTENSION                             ,
        "$(SETTINGS-EDITOR-ID)"  =>   $ID                                    ,
        "$(SETTINGS-DB)"         =>   $PICKDB                                ,
        "$(SETTINGS-TABLE)"      =>   $SEZTAB                                ,
        "$(SETTINGS-EDIT)"       =>   $Edit                                  ,
        "$(SETTINGS-EDITABLE)"   =>   $EDITABLE                              ,
        "$(SETTINGS-READONLY)"   =>   $READONLY                              ,
        "$(SETTING-ITEM-ID)"     =>   $rr [ 0 ]                              ,
        "$(SETTINGS-USERNAME)"   =>   $rr [ 1 ]                              ,
        "$(SETTINGS-SCOPE)"      =>   $rr [ 2 ]                              ,
        "$(SETTINGS-KEYWORD)"    =>   $rr [ 3 ]                              ,
        "$(SETTINGS-VALUE)"      =>   $rr [ 4 ]                              ,
      )                                                                      ;
      $HTML    = Strings::ReplaceByKeys   ( $TEMPL , $MAPX                 ) ;
      array_push                          ( $ITEMS , $HTML                 ) ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMX       = implode                  ( "" , $ITEMS                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(EXTENSION-PATH)"      =>   $EXTENSION                                 ,
    "$(SETTINGS-EDITOR-ID)"  =>   $ID                                        ,
    "$(SETTINGS-DB)"         =>   $PICKDB                                    ,
    "$(SETTINGS-TABLE)"      =>   $SEZTAB                                    ,
    "$(SETTINGS-EDIT)"       =>   $Edit                                      ,
    "$(SETTINGS-EDITABLE)"   =>   $EDITABLE                                  ,
    "$(SETTINGS-READONLY)"   =>   $READONLY                                  ,
    "$(SETTINGS-ITEMS)"      =>   $ITEMX                                     ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $HTML = Strings::ReplaceFileByKeys      ( $TEMPLFILE , $MAPS             ) ;
  return array                                                               (
    "HTML"     => $HTML                                                      ,
    "Complete" => "<div id='{$ID}'>{$HTML}</div>"                            ,
  )                                                                          ;
}
//////////////////////////////////////////////////////////////////////////////
// 參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsEditor ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $HTML  = self::SettingsEditorDB     ( $DBX                                 ,
                                        $argv                                ,
                                        $Content                             ,
                                        $Options                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return $HTML [ "Complete" ]                                                ;
}
//////////////////////////////////////////////////////////////////////////////
// CheckBox參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsCheckBox   ( $argv , $Content , $Options    ) {
  ////////////////////////////////////////////////////////////////////////////
  $ID          = self::RandomString       ( "Input-" , 24                  ) ;
  $PICKDB      = self::GetTag             ( "database" , $argv             ) ;
  $HOST        = self::GetCurrentDB       ( $argv , $Options               ) ;
  $SEZTAB      = self::GetAssignTable     ( "`settings`"                     ,
                                            $argv                            ,
                                            $Options                       ) ;
  $TEMPID      = "Settings::CheckBox"                                        ;
  ////////////////////////////////////////////////////////////////////////////
  $SETS        = new Settings             (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options                 [ "Templates"                    ] ;
  $EXTENSION   = $Options                 [ "AITK"                         ] ;
  $PATHX       = $Options                 [ "Extension"                    ] ;
  $TEMPLFILE   = $Templates               [ $TEMPID                        ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $USERNAME    = ""                                                          ;
  $SCOPEX      = ""                                                          ;
  $KEYWORD     = ""                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARAMETERS  = array                    (                                ) ;
  $KEYs        = array_keys               ( $argv                          ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                                 ( $KEYs as $K                    ) {
    //////////////////////////////////////////////////////////////////////////
    $S         = strtolower               ( $K                             ) ;
    //////////////////////////////////////////////////////////////////////////
    switch                                ( $S                             ) {
      ////////////////////////////////////////////////////////////////////////
      case "function"                                                        :
      case "method"                                                          :
      case "database"                                                        :
      case "table"                                                           :
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "id"                                                              :
        $ID    = self::GetTag             ( "id"       , $argv             ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "username"                                                        :
        $USR   = self::GetTag             ( "username" , $argv             ) ;
        $USERNAME = $USR                                                     ;
        $SETS -> set                      ( "Username" , $USR              ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "scope"                                                           :
        $Scope = self::GetTag             ( "scope"    , $argv             ) ;
        $SCOPEX   = $Scope                                                   ;
        $SETS -> set                      ( "Scope"    , $Scope            ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "keyword"                                                         :
        $KW    = self::GetTag             ( "keyword"  , $argv             ) ;
        $KEYWORD  = $KW                                                      ;
        $SETS -> set                      ( "Keyword"  , $KW               ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      default                                                                :
        $V     = self::GetTag             ( $K , $argv                     ) ;
        array_push                        ( $PARAMETERS , "{$K}='{$V}'"    ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB                   (                                ) ;
  if                                      ( ! $DBX -> Connect ( $HOST )    ) {
    return $DBX -> ConnectionError        (                                ) ;
  }                                                                          ;
  $VALUE       = $SETS -> obtainValue     ( $DBX , $SEZTAB                 ) ;
  $DBX        -> Close                    (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  if                                      ( $VALUE > 0                     ) {
    array_push                            ( $PARAMETERS , "checked"        ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARMS       = ""                                                          ;
  if                                      ( count ( $PARAMETERS ) > 0      ) {
    $PARMS     = implode                  ( " " , $PARAMETERS              ) ;
    $PARMS     = " {$PARMS}"                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(SETTINGS-ID)"         =>   $ID                                        ,
    "$(SETTINGS-DB)"         =>   $PICKDB                                    ,
    "$(SETTINGS-TABLE)"      =>   $SEZTAB                                    ,
    "$(SETTINGS-USERNAME)"   =>   $USERNAME                                  ,
    "$(SETTINGS-SCOPE)"      =>   $SCOPEX                                    ,
    "$(SETTINGS-KEYWORD)"    =>   $KEYWORD                                   ,
    "$(SETTINGS-PARAMETERS)" =>   $PARMS                                     ,
    "$(SETTINGS-TEXT)"       =>   $Content                                   ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys       ( $TEMPLFILE , $MAPS             ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 輸入參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsInputer    ( $argv                            ,
                                            $Content                         ,
                                            $Options                         ,
                                            $TEMPID                        ) {
  ////////////////////////////////////////////////////////////////////////////
  $PICKDB      = self::GetTag             ( "database" , $argv             ) ;
  $HOST        = self::GetCurrentDB       ( $argv , $Options               ) ;
  $SEZTAB      = self::GetAssignTable     ( "`settings`"                     ,
                                            $argv                            ,
                                            $Options                       ) ;
  ////////////////////////////////////////////////////////////////////////////
  $SETS        = new Settings             (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options                 [ "Templates"                    ] ;
  $EXTENSION   = $Options                 [ "AITK"                         ] ;
  $PATHX       = $Options                 [ "Extension"                    ] ;
  $TEMPLFILE   = $Templates               [ $TEMPID                        ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $USERNAME    = ""                                                          ;
  $SCOPEX      = ""                                                          ;
  $KEYWORD     = ""                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARAMETERS  = array                    (                                ) ;
  $KEYs        = array_keys               ( $argv                          ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                                 ( $KEYs as $K                    ) {
    //////////////////////////////////////////////////////////////////////////
    $S         = strtolower               ( $K                             ) ;
    //////////////////////////////////////////////////////////////////////////
    switch                                ( $S                             ) {
      ////////////////////////////////////////////////////////////////////////
      case "function"                                                        :
      case "method"                                                          :
      case "database"                                                        :
      case "table"                                                           :
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "username"                                                        :
        $USR   = self::GetTag             ( "username" , $argv             ) ;
        $USERNAME = $USR                                                     ;
        $SETS -> set                      ( "Username" , $USR              ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "scope"                                                           :
        $Scope = self::GetTag             ( "scope"    , $argv             ) ;
        $SCOPEX   = $Scope                                                   ;
        $SETS -> set                      ( "Scope"    , $Scope            ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "keyword"                                                         :
        $KW    = self::GetTag             ( "keyword"  , $argv             ) ;
        $KEYWORD  = $KW                                                      ;
        $SETS -> set                      ( "Keyword"  , $KW               ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      default                                                                :
        $V     = self::GetTag             ( $K , $argv                     ) ;
        array_push                        ( $PARAMETERS , "{$K}='{$V}'"    ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB                   (                                ) ;
  if                                      ( ! $DBX -> Connect ( $HOST )    ) {
    return $DBX -> ConnectionError        (                                ) ;
  }                                                                          ;
  $VALUE       = $SETS -> obtainValue     ( $DBX , $SEZTAB                 ) ;
  $DBX        -> Close                    (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $PARMS       = ""                                                          ;
  if                                      ( count ( $PARAMETERS ) > 0      ) {
    $PARMS     = implode                  ( " " , $PARAMETERS              ) ;
    $PARMS     = " {$PARMS}"                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(SETTINGS-DB)"         =>   $PICKDB                                    ,
    "$(SETTINGS-TABLE)"      =>   $SEZTAB                                    ,
    "$(SETTINGS-USERNAME)"   =>   $USERNAME                                  ,
    "$(SETTINGS-SCOPE)"      =>   $SCOPEX                                    ,
    "$(SETTINGS-KEYWORD)"    =>   $KEYWORD                                   ,
    "$(SETTINGS-VALUE)"      =>   $VALUE                                     ,
    "$(SETTINGS-PARAMETERS)" =>   $PARMS                                     ,
    "$(SETTINGS-TEXT)"       =>   $Content                                   ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys       ( $TEMPLFILE , $MAPS             ) ;
}
//////////////////////////////////////////////////////////////////////////////
// Number參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsNumber     ( $argv , $Content , $Options    ) {
  return self::SettingsInputer            ( $argv                            ,
                                            $Content                         ,
                                            $Options                         ,
                                            "Settings::Number"             ) ;
}
//////////////////////////////////////////////////////////////////////////////
// Text參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsText       ( $argv , $Content , $Options    ) {
  return self::SettingsInputer            ( $argv                            ,
                                            $Content                         ,
                                            $Options                         ,
                                            "Settings::Text"               ) ;
}
//////////////////////////////////////////////////////////////////////////////
// StarDate參數設定編輯器
//////////////////////////////////////////////////////////////////////////////
public static function SettingsStarDate   ( $argv , $Content , $Options    ) {
  ////////////////////////////////////////////////////////////////////////////
  $PICKDB      = self::GetTag             ( "database" , $argv             ) ;
  $HOST        = self::GetCurrentDB       ( $argv , $Options               ) ;
  $SEZTAB      = self::GetAssignTable     ( "`settings`"                     ,
                                            $argv                            ,
                                            $Options                       ) ;
  $TEMPID      = "Settings::DateTime"                                        ;
  ////////////////////////////////////////////////////////////////////////////
  $SETS        = new Settings             (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options                 [ "Templates"                    ] ;
  $EXTENSION   = $Options                 [ "AITK"                         ] ;
  $PATHX       = $Options                 [ "Extension"                    ] ;
  $TEMPLFILE   = $Templates               [ $TEMPID                        ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $USERNAME    = ""                                                          ;
  $SCOPEX      = ""                                                          ;
  $KEYWORD     = ""                                                          ;
  $TZ          = "Asia/Taipei"                                               ;
  ////////////////////////////////////////////////////////////////////////////
  $PARAMETERS  = array                    (                                ) ;
  $KEYs        = array_keys               ( $argv                          ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                                 ( $KEYs as $K                    ) {
    //////////////////////////////////////////////////////////////////////////
    $S         = strtolower               ( $K                             ) ;
    //////////////////////////////////////////////////////////////////////////
    switch                                ( $S                             ) {
      ////////////////////////////////////////////////////////////////////////
      case "function"                                                        :
      case "method"                                                          :
      case "database"                                                        :
      case "table"                                                           :
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "username"                                                        :
        $USR   = self::GetTag             ( "username" , $argv             ) ;
        $USERNAME = $USR                                                     ;
        $SETS -> set                      ( "Username" , $USR              ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "scope"                                                           :
        $Scope = self::GetTag             ( "scope"    , $argv             ) ;
        $SCOPEX   = $Scope                                                   ;
        $SETS -> set                      ( "Scope"    , $Scope            ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "keyword"                                                         :
        $KW    = self::GetTag             ( "keyword"  , $argv             ) ;
        $KEYWORD  = $KW                                                      ;
        $SETS -> set                      ( "Keyword"  , $KW               ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      case "timezone"                                                        :
        $TZ    = self::GetTag             ( "timezone" , $argv             ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
      default                                                                :
        $V     = self::GetTag             ( $K , $argv                     ) ;
        array_push                        ( $PARAMETERS , "{$K}='{$V}'"    ) ;
      break                                                                  ;
      ////////////////////////////////////////////////////////////////////////
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB                   (                                ) ;
  if                                      ( ! $DBX -> Connect ( $HOST )    ) {
    return $DBX -> ConnectionError        (                                ) ;
  }                                                                          ;
  $VALUE       = $SETS -> obtainValue     ( $DBX , $SEZTAB                 ) ;
  $DBX        -> Close                    (                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $NOW         = new StarDate             (                                ) ;
  if                                      ( strlen ( $VALUE ) > 0          ) {
    $NOW      -> Stardate = $VALUE                                           ;
  } else                                                                     {
    $NOW      -> Now                      (                                ) ;
  }                                                                          ;
  $DATETIME    = $NOW -> toDateTimeString ( $TZ , "T" , "Y-m-d" , "H:i:s"  ) ;
  ////////////////////////////////////////////////////////////////////////////
  $PARMS       = ""                                                          ;
  if                                      ( count ( $PARAMETERS ) > 0      ) {
    $PARMS     = implode                  ( " " , $PARAMETERS              ) ;
    $PARMS     = " {$PARMS}"                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(SETTINGS-DB)"         =>   $PICKDB                                    ,
    "$(SETTINGS-TABLE)"      =>   $SEZTAB                                    ,
    "$(SETTINGS-USERNAME)"   =>   $USERNAME                                  ,
    "$(SETTINGS-SCOPE)"      =>   $SCOPEX                                    ,
    "$(SETTINGS-KEYWORD)"    =>   $KEYWORD                                   ,
    "$(SETTINGS-VALUE)"      =>   $DATETIME                                  ,
    "$(SETTINGS-TZ)"         =>   $TZ                                        ,
    "$(SETTINGS-PARAMETERS)" =>   $PARMS                                     ,
    "$(SETTINGS-TEXT)"       =>   $Content                                   ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys       ( $TEMPLFILE , $MAPS             ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 參數設定介面進入點
//////////////////////////////////////////////////////////////////////////////
public static function SettingsUI    ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Method      = self::GetTag        ( "method"    , $argv                 ) ;
  $Method      = strtolower          ( $Method                             ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                             ( $Method                             ) {
    //////////////////////////////////////////////////////////////////////////
    case "editor"                                                            :
    return self::SettingsEditor      ( $argv , $Content , $Options         ) ;
    //////////////////////////////////////////////////////////////////////////
    case "checkbox"                                                          :
    return self::SettingsCheckBox    ( $argv , $Content , $Options         ) ;
    //////////////////////////////////////////////////////////////////////////
    case "number"                                                            :
    return self::SettingsNumber      ( $argv , $Content , $Options         ) ;
    //////////////////////////////////////////////////////////////////////////
    case "text"                                                              :
    return self::SettingsText        ( $argv , $Content , $Options         ) ;
    //////////////////////////////////////////////////////////////////////////
    case "stardate"                                                          :
    return self::SettingsStarDate    ( $argv , $Content , $Options         ) ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return ""                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 目錄列表
//////////////////////////////////////////////////////////////////////////////
public static function ListDirectory ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 圖片
//////////////////////////////////////////////////////////////////////////////
public static function PictureUI     ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 圖示
//////////////////////////////////////////////////////////////////////////////
public static function IconUI        ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 頭像
//////////////////////////////////////////////////////////////////////////////
public static function AvatarUI      ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// YouTube
//////////////////////////////////////////////////////////////////////////////
public static function ExportYouTube ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 時區
//////////////////////////////////////////////////////////////////////////////
public static function TimeZones     ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 網站密碼
//////////////////////////////////////////////////////////////////////////////
public static function HtPasswd      ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 資料庫表格
//////////////////////////////////////////////////////////////////////////////
public static function GetSqlTable   ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Content ) <= 0            ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  $TOTAL = ""                                                                ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARAMETERs  = [ "function" , "method" , "database" , "table" ]            ;
  ////////////////////////////////////////////////////////////////////////////
  $TITLEs      = array               (                                     ) ;
  $COLUMNS     = self::GetTag        ( "columns"   , $argv                 ) ;
  if                                 ( strlen ( $COLUMNS ) > 0             ) {
    array_push                       ( $PARAMETERs , "columns"             ) ;
    $TOTAL     = intval              ( $COLUMNS    , 10                    ) ;
    if                               ( ( $TOTAL > 0 ) and ( $TOTAL < 51 )  ) {
      for                            ( $II = 0 ; $II < $TOTAL ; $II++      ) {
        //////////////////////////////////////////////////////////////////////
        $TITLE = self::GetTag        ( $II         , $argv                 ) ;
        array_push                   ( $TITLEs     , $TITLE                ) ;
        array_push                   ( $PARAMETERs , "$II"                 ) ;
        //////////////////////////////////////////////////////////////////////
      }                                                                      ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $HT          = new Html             (                                    ) ;
  $HT         -> setTag               ( "table"                            ) ;
  ////////////////////////////////////////////////////////////////////////////
  $VARs        = array_keys           ( $argv                              ) ;
  foreach                             ( $VARs as $V                        ) {
    $Z         = strtolower           ( $V                                 ) ;
    if                                ( ! in_array ( $Z , $PARAMETERs )    ) {
      $HT     -> AddPair              ( $V , $argv [ $V ]                  ) ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $THREAD      = $HT     -> addHtml   ( "thread"                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $TBODY       = $HT     -> addHtml   ( "tbody"                            ) ;
  ////////////////////////////////////////////////////////////////////////////
  $qq          = $DBX    -> Query     ( $Content                           ) ;
  if                                  ( $DBX -> hasResult ( $qq )          ) {
    while ( $rr = $qq -> fetch_array ( MYSQLI_ASSOC ) )                      {
      ////////////////////////////////////////////////////////////////////////
      $KEYs    = array_keys           ( $rr                                ) ;
      if                              ( count ( $TITLEs ) <= 0             ) {
        $TITLEs = $KEYs                                                      ;
      }                                                                      ;
      ////////////////////////////////////////////////////////////////////////
      $TRX     = $TBODY -> addTr      (                                    ) ;
      ////////////////////////////////////////////////////////////////////////
      foreach                         ( $KEYs as $K                        ) {
        $TRX  -> addTd                ( $rr [ $K ]                         ) ;
      }                                                                      ;
      ////////////////////////////////////////////////////////////////////////
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                  ( count ( $TITLEs ) > 0              ) {
    //////////////////////////////////////////////////////////////////////////
    $TRX       = $THREAD -> addTr     (                                    ) ;
    foreach                           ( $TITLEs as $T                      ) {
      $TD      = $TRX    -> addTd     ( $T                                 ) ;
      $TD     -> AddPair              ( "class" , "SqlTableHeader"         ) ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
    $TFOOT     = $HT     -> addHtml   ( "tfoot"                            ) ;
    //////////////////////////////////////////////////////////////////////////
    $TRX       = $TFOOT  -> addTr     (                                    ) ;
    foreach                           ( $TITLEs as $T                      ) {
      $TD      = $TRX    -> addTd     ( $T                                 ) ;
      $TD     -> AddPair              ( "class" , "SqlTableHeader"         ) ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return $HT -> Content               (                                    ) ;
}
//////////////////////////////////////////////////////////////////////////////
// 資料庫介面
//////////////////////////////////////////////////////////////////////////////
public static function GetSqlValue   ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Content ) <= 0            ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  $TOTAL = ""                                                                ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $V           = $DBX -> FetchOne     ( $Content                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return "{$V}"                                                              ;
}
//////////////////////////////////////////////////////////////////////////////
// 資料庫介面
//////////////////////////////////////////////////////////////////////////////
public static function SqlInterface  ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Method      = self::GetTag        ( "method" , $argv                    ) ;
  $Method      = strtolower          ( $Method                             ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                             ( $Method                             ) {
    case "value"                                                             :
    return self::GetSqlValue         ( $argv , $Content , $Options         ) ;
    case "table"                                                             :
    return self::GetSqlTable         ( $argv , $Content , $Options         ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $argv                               ) ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型計數
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypeCounts ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  $TOTAL = ""                                                                ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $TYPETABLE   = self::GetAssignTable ( "`types`" , $argv , $Options       ) ;
  ////////////////////////////////////////////////////////////////////////////
  $QQ          = "select count(*) from {$TYPETABLE}"                         .
                 " where ( `used` > 0 ) ;"                                   ;
  $TOTAL       = $DBX -> FetchOne     ( $QQ                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return "{$Content}{$TOTAL}"                                                ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型起始基數
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypeBase   ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  $TOTAL = ""                                                                ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $TYPETABLE   = self::GetAssignTable ( "`types`" , $argv , $Options       ) ;
  $TYPEID      = self::GetTag         ( "type"    , $argv                  ) ;
  ////////////////////////////////////////////////////////////////////////////
  $QQ          = "select `head` from {$TYPETABLE}"                           .
                 " where ( `id` = {$TYPEID} ) ;"                             ;
  $BASE        = $DBX -> FetchOne     ( $QQ                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return "{$Content}{$BASE}"                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型最大數值
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypeMax    ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  $TOTAL = ""                                                                ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $TYPETABLE   = self::GetAssignTable ( "`types`" , $argv , $Options       ) ;
  $TYPEID      = self::GetTag         ( "type"    , $argv                  ) ;
  ////////////////////////////////////////////////////////////////////////////
  $MAXV        = 0                                                           ;
  $QQ          = "select `head`,`digits` from {$TYPETABLE}"                  .
                 " where ( `id` = {$TYPEID} ) ;"                             ;
  $qq          = $DBX -> Query        ( $QQ                                ) ;
  if                                  ( $DBX -> hasResult ( $qq )          ) {
    //////////////////////////////////////////////////////////////////////////
    $rr        = $qq -> fetch_array   ( MYSQLI_BOTH                        ) ;
    //////////////////////////////////////////////////////////////////////////
    $BASE      = $rr [ 0 ]                                                   ;
    $DIGITS    = $rr [ 1 ]                                                   ;
    //////////////////////////////////////////////////////////////////////////
    $AMOUNT    = 1                                                           ;
    for                               ( $II = 0 ; $II < $DIGITS ; $II++    ) {
      $AMOUNT  = intval               ( $AMOUNT * 10 , 10                  ) ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
    $MAXV      = intval               ( $BASE + $AMOUNT - 1 , 10           ) ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return "{$Content}{$MAXV}"                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型總數
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypeAmount ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  $TOTAL = ""                                                                ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $TYPETABLE   = self::GetAssignTable ( "`types`" , $argv , $Options       ) ;
  $TYPEID      = self::GetTag         ( "type"    , $argv                  ) ;
  ////////////////////////////////////////////////////////////////////////////
  $QQ          = "select `digits` from {$TYPETABLE}"                         .
                 " where ( `id` = {$TYPEID} ) ;"                             ;
  $DIGITS      = $DBX -> FetchOne     ( $QQ                                ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  $AMOUNT      = 1                                                           ;
  for                                 ( $II = 0 ; $II < $DIGITS ; $II++    ) {
    $AMOUNT    = intval               ( $AMOUNT * 10 , 10                  ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return "{$Content}{$AMOUNT}"                                               ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型列表
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypeListings ( $argv , $Content , $Options      ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PICKDB      = self::GetTag         ( "database" , $argv                 ) ;
  $TYPETAB     = self::GetAssignTable ( "`types`" , $argv , $Options       ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DISPs       = array                (                                    ) ;
  $COLs        = [ "id"       => "$(DISPLAY-COLUMN-ID)"                      ,
                   "uuid"     => "$(DISPLAY-COLUMN-UUID)"                    ,
                   "used"     => "$(DISPLAY-COLUMN-USED)"                    ,
                   "name"     => "$(DISPLAY-COLUMN-NAME)"                    ,
                   "head"     => "$(DISPLAY-COLUMN-HEAD)"                    ,
                   "digits"   => "$(DISPLAY-COLUMN-DIGITS)"                  ,
                   "ready"    => "$(DISPLAY-COLUMN-READY)"                   ,
                   "comment"  => "$(DISPLAY-COLUMN-COMMENT)"                 ,
                   "wiki"     => "$(DISPLAY-COLUMN-WIKI)"                    ,
                   "ltime"    => "$(DISPLAY-COLUMN-UPDATE)"                ] ;
  $KEYs        = array_keys           ( $COLs                              ) ;
  foreach                             ( $KEYs as $K                        ) {
    $S         = self::GetTag         ( $K , $argv                         ) ;
    $S         = strtolower           ( $S                                 ) ;
    $V         = $COLs                [ $K                                 ] ;
    $DISPs [ $V ] = ""                                                       ;
    if ( in_array ( $S , [ "false" , "no" , "hide" , "0" ] ) )               {
      $DISPs [ $V ] = "display: none;"                                       ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ORDERBY     = "order by `id` asc"                                         ;
  $ORDERS      = self::GetTag         ( "order" , $argv                    ) ;
  if                                  ( strlen ( $ORDERS ) > 0             ) {
    $ORDERBY   = $ORDERS                                                     ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $WIKI        = $Options             [ "Configure" ] [ "item" ]             ;
  $Templates   = $Options             [ "Templates"                        ] ;
  $EXTENSION   = $Options             [ "AITK"                             ] ;
  $PATHX       = $Options             [ "Extension"                        ] ;
  ////////////////////////////////////////////////////////////////////////////
  $TEMPLFILE   = $Templates           [ "CIOS::Types::Columns"             ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  $COLUMNS     = file_get_contents    ( $TEMPLFILE                         ) ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMFILE    = $Templates           [ "CIOS::Types::Item"                ] ;
  $ITEMFILE    = "{$PATHX}/{$ITEMFILE}"                                      ;
  $TEMPL       = file_get_contents    ( $ITEMFILE                          ) ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMs       = array                (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  $QQ          = "select `id`,`uuid`,`used`,`name`,`head`,`digits`,`ready`,`comment`,`wiki`,`ltime`" .
                 " from {$TYPETAB}"                                          .
                 " where ( `used` > 0 )"                                     .
                 " {$ORDERBY} ;"                                             ;
  $qq          = $DBX -> Query        ( $QQ                                ) ;
  if                                  ( $DBX -> hasResult ( $qq )          ) {
    while ( $rr = $qq -> fetch_array ( MYSQLI_BOTH )                       ) {
      $MAPX    = array                                                       (
        "$(EXTENSION-PATH)"       =>   $EXTENSION                            ,
        "$(WIKI-PATH)"            =>   $WIKI                                 ,
        "$(CIOS-TYPE-DB)"         =>   $PICKDB                               ,
        "$(CIOS-TYPE-TABLE)"      =>   $TYPETAB                              ,
        "$(CIOS-TYPE-ID)"         =>   $rr [ 0 ]                             ,
        "$(CIOS-TYPE-UUID)"       =>   $rr [ 1 ]                             ,
        "$(CIOS-TYPE-USED)"       =>   $rr [ 2 ]                             ,
        "$(CIOS-TYPE-NAME)"       =>   $rr [ 3 ]                             ,
        "$(CIOS-TYPE-HEAD)"       =>   $rr [ 4 ]                             ,
        "$(CIOS-TYPE-DIGITS)"     =>   $rr [ 5 ]                             ,
        "$(CIOS-TYPE-READY)"      =>   $rr [ 6 ]                             ,
        "$(CIOS-TYPE-COMMENT)"    =>   $rr [ 7 ]                             ,
        "$(CIOS-TYPE-WIKI)"       =>   $rr [ 8 ]                             ,
        "$(CIOS-TYPE-UPDATE)"     =>   $rr [ 9 ]                             ,
      )                                                                      ;
      $KEYs    = array_keys               ( $DISPs                         ) ;
      foreach                             ( $KEYs as $K                    ) {
        $MAPX [ $K ] = $DISPs [ $K ]                                         ;
      }                                                                      ;
      $HTML    = Strings::ReplaceByKeys   ( $TEMPL , $MAPX                 ) ;
      array_push                          ( $ITEMs , $HTML                 ) ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMX       = implode              ( "\n" , $ITEMs                      ) ;
  $MAPS        = array                                                       (
    "$(EXTENSION-PATH)"       =>   $EXTENSION                                ,
    "$(WIKI-PATH)"            =>   $WIKI                                     ,
    "$(CIOS-TYPE-DB)"         =>   $PICKDB                                   ,
    "$(CIOS-TYPE-TABLE)"      =>   $TYPETAB                                  ,
    "$(CIOS-TYPE-LISTINGS)"   =>   $ITEMX                                    ,
  )                                                                          ;
  $KEYs        = array_keys           ( $DISPs                             ) ;
  foreach                             ( $KEYs as $K                        ) {
    $MAPS [ $K ] = $DISPs [ $K ]                                             ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceByKeys       ( $COLUMNS , $MAPS                   ) ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型編輯器
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypesEditor ( $argv , $Content , $Options       ) {
  ////////////////////////////////////////////////////////////////////////////
  $HOST  = self::GetCurrentDB         ( $argv , $Options                   ) ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX         = new DB               (                                    ) ;
  if                                  ( ! $DBX -> Connect ( $HOST )        ) {
    return $DBX -> ConnectionError    (                                    ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PICKDB      = self::GetTag         ( "database" , $argv                 ) ;
  $TYPETAB     = self::GetAssignTable ( "`types`"  , $argv , $Options      ) ;
  $MINV        = self::GetTag         ( "min"      , $argv                 ) ;
  $MAXV        = self::GetTag         ( "max"      , $argv                 ) ;
  ////////////////////////////////////////////////////////////////////////////
  $USING       = self::GetTag         ( "using"    , $argv                 ) ;
  $USING       = strtolower           ( $USING                             ) ;
  $USESQL      = ""                                                          ;
  if ( in_array ( $USING , [ "true" , "yes" ] ) )                            {
    $USESQL    = " and ( `used` > 0 )"                                       ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DISPs       = array                (                                    ) ;
  $COLs        = [ "id"       => "$(DISPLAY-COLUMN-ID)"                      ,
                   "uuid"     => "$(DISPLAY-COLUMN-UUID)"                    ,
                   "used"     => "$(DISPLAY-COLUMN-USED)"                    ,
                   "name"     => "$(DISPLAY-COLUMN-NAME)"                    ,
                   "head"     => "$(DISPLAY-COLUMN-HEAD)"                    ,
                   "digits"   => "$(DISPLAY-COLUMN-DIGITS)"                  ,
                   "ready"    => "$(DISPLAY-COLUMN-READY)"                   ,
                   "comment"  => "$(DISPLAY-COLUMN-COMMENT)"                 ,
                   "wiki"     => "$(DISPLAY-COLUMN-WIKI)"                    ,
                   "ltime"    => "$(DISPLAY-COLUMN-UPDATE)"                ] ;
  $KEYs        = array_keys           ( $COLs                              ) ;
  foreach                             ( $KEYs as $K                        ) {
    $S         = self::GetTag         ( $K , $argv                         ) ;
    $S         = strtolower           ( $S                                 ) ;
    $V         = $COLs                [ $K                                 ] ;
    $DISPs [ $V ] = ""                                                       ;
    if ( in_array ( $S , [ "false" , "no" , "hide" , "0" ] ) )               {
      $DISPs [ $V ] = "display: none;"                                       ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ORDERBY     = "order by `id` asc"                                         ;
  $ORDERS      = self::GetTag         ( "order" , $argv                    ) ;
  if                                  ( strlen ( $ORDERS ) > 0             ) {
    $ORDERBY   = $ORDERS                                                     ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $WIKI        = $Options             [ "Configure" ] [ "item" ]             ;
  $Templates   = $Options             [ "Templates"                        ] ;
  $EXTENSION   = $Options             [ "AITK"                             ] ;
  $PATHX       = $Options             [ "Extension"                        ] ;
  ////////////////////////////////////////////////////////////////////////////
  $TEMPLFILE   = $Templates           [ "CIOS::Types::Columns"             ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  $COLUMNS     = file_get_contents    ( $TEMPLFILE                         ) ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMFILE    = $Templates           [ "CIOS::Types::Editor"              ] ;
  $ITEMFILE    = "{$PATHX}/{$ITEMFILE}"                                      ;
  $TEMPL       = file_get_contents    ( $ITEMFILE                          ) ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMs       = array                (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  $QQ          = "select `id`,`uuid`,`used`,`name`,`head`,`digits`,`ready`,`comment`,`wiki`,`ltime`" .
                 " from {$TYPETAB}"                                          .
                 " where ( `id` >= {$MINV} )"                                .
                   " and ( `id` <= {$MAXV} )"                                .
                 "{$USESQL} {$ORDERBY} ;"                                    ;
  $qq          = $DBX -> Query        ( $QQ                                ) ;
  if                                  ( $DBX -> hasResult ( $qq )          ) {
    while ( $rr = $qq -> fetch_array ( MYSQLI_BOTH )                       ) {
      $MAPX    = array                                                       (
        "$(EXTENSION-PATH)"       =>   $EXTENSION                            ,
        "$(WIKI-PATH)"            =>   $WIKI                                 ,
        "$(CIOS-TYPE-DB)"         =>   $PICKDB                               ,
        "$(CIOS-TYPE-TABLE)"      =>   $TYPETAB                              ,
        "$(CIOS-TYPE-ID)"         =>   $rr [ 0 ]                             ,
        "$(CIOS-TYPE-UUID)"       =>   $rr [ 1 ]                             ,
        "$(CIOS-TYPE-USED)"       =>   $rr [ 2 ]                             ,
        "$(CIOS-TYPE-NAME)"       =>   $rr [ 3 ]                             ,
        "$(CIOS-TYPE-HEAD)"       =>   $rr [ 4 ]                             ,
        "$(CIOS-TYPE-DIGITS)"     =>   $rr [ 5 ]                             ,
        "$(CIOS-TYPE-READY)"      =>   $rr [ 6 ]                             ,
        "$(CIOS-TYPE-COMMENT)"    =>   $rr [ 7 ]                             ,
        "$(CIOS-TYPE-WIKI)"       =>   $rr [ 8 ]                             ,
        "$(CIOS-TYPE-UPDATE)"     =>   $rr [ 9 ]                             ,
      )                                                                      ;
      $KEYs    = array_keys               ( $DISPs                         ) ;
      foreach                             ( $KEYs as $K                    ) {
        $MAPX [ $K ] = $DISPs [ $K ]                                         ;
      }                                                                      ;
      $HTML    = Strings::ReplaceByKeys   ( $TEMPL , $MAPX                 ) ;
      array_push                          ( $ITEMs , $HTML                 ) ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMX       = implode              ( "\n" , $ITEMs                      ) ;
  $MAPS        = array                                                       (
    "$(EXTENSION-PATH)"       =>   $EXTENSION                                ,
    "$(WIKI-PATH)"            =>   $WIKI                                     ,
    "$(CIOS-TYPE-DB)"         =>   $PICKDB                                   ,
    "$(CIOS-TYPE-TABLE)"      =>   $TYPETAB                                  ,
    "$(CIOS-TYPE-LISTINGS)"   =>   $ITEMX                                    ,
  )                                                                          ;
  $KEYs        = array_keys           ( $DISPs                             ) ;
  foreach                             ( $KEYs as $K                        ) {
    $MAPS [ $K ] = $DISPs [ $K ]                                             ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DBX  -> Close                      (                                    ) ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceByKeys       ( $COLUMNS , $MAPS                   ) ;
}
//////////////////////////////////////////////////////////////////////////////
// CIOS 物件類型處理進入點
//////////////////////////////////////////////////////////////////////////////
public static function CiosTypes     ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Method      = self::GetTag        ( "method" , $argv                    ) ;
  $Method      = strtolower          ( $Method                             ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                             ( $Method                             ) {
    case "total"                                                             :
    return self::CiosTypeCounts      ( $argv , $Content , $Options         ) ;
    case "base"                                                              :
    return self::CiosTypeBase        ( $argv , $Content , $Options         ) ;
    case "max"                                                               :
    return self::CiosTypeMax         ( $argv , $Content , $Options         ) ;
    case "amount"                                                            :
    return self::CiosTypeAmount      ( $argv , $Content , $Options         ) ;
    case "listings"                                                          :
    return self::CiosTypeListings    ( $argv , $Content , $Options         ) ;
    case "editor"                                                            :
    return self::CiosTypesEditor     ( $argv , $Content , $Options         ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $argv                               ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// CIOS Tags
//////////////////////////////////////////////////////////////////////////////
public static function CiosTags      ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Scope       = self::GetTag        ( "scope" , $argv                     ) ;
  $Scope       = strtolower          ( $Scope                              ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                             ( $Scope                              ) {
    case "types"                                                             :
    return self::CiosTypes           ( $argv , $Content , $Options         ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $argv                               ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// CIOS AJAX進入點
//////////////////////////////////////////////////////////////////////////////
public static function CiosAJAX      ( $DB , $PICKDB , $TABLE , $HH , $AA  ) {
  ////////////////////////////////////////////////////////////////////////////
  $METHOD      = $HH -> Parameter    ( "Method"                            ) ;
  $ID          = $HH -> Parameter    ( "Id"                                ) ;
  $COLUMN      = $HH -> Parameter    ( "Column"                            ) ;
  $VALUE       = $HH -> Parameter    ( "Value"                             ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                             ( $METHOD                             ) {
    case "Update"                                                            :
      $DB     -> LockWrites          ( [ $TABLE                          ] ) ;
      $QQ      = "update {$TABLE} set `{$COLUMN}` = ?"                       .
                 " where ( `id` = {$ID} ) ;"                                 ;
      $qq      = $DB -> Prepare      ( $QQ                                 ) ;
      $qq     -> bind_param          ( 's' , $VALUE                        ) ;
      $qq     -> execute             (                                     ) ;
      $DB     -> UnlockTables        (                                     ) ;
    break                                                                    ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Answer" ] = "Yes"                                                   ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// 民族語
//////////////////////////////////////////////////////////////////////////////
public static function Ethnologue    ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// +| HtPwdListings |+
// HtPassword Listings
//////////////////////////////////////////////////////////////////////////////
public static function HtPwdListings   ( $ID                                 ,
                                         $HTPASSWD                           ,
                                         $FILE                               ,
                                         $LANG                               ,
                                         $WIDTH                              ,
                                         $APPEND                             ,
                                         $DELETE                           ) {
  ////////////////////////////////////////////////////////////////////////////
  $canAppend    = strtolower           ( $APPEND                           ) ;
  $DISPAPPEND   = ""                                                         ;
  if ( in_array ( $canAppend , [ "yes" , "true" ] ) )                        {
    $canAppend  = true                                                       ;
  } else                                                                     {
    $canAppend  = false                                                      ;
    $DISPAPPEND = "display: none;"                                           ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $canDelete    = strtolower           ( $DELETE                           ) ;
  if ( in_array ( $canDelete , [ "yes" , "true" ] ) )                        {
    $canDelete  = true                                                       ;
  } else                                                                     {
    $canDelete  = false                                                      ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $ACCOUNTS     = file_get_contents    ( $FILE                             ) ;
  $ACCTS        = explode              ( "\n" , $ACCOUNTS                  ) ;
  $LISTS        = array                (                                   ) ;
  foreach                              ( $ACCTS as $act                    ) {
    if                                 ( strlen ( $act ) > 0               ) {
      $LL       = explode              ( ":" , $act                        ) ;
      if                               ( count ( $LL ) > 1                 ) {
        array_push                     ( $LISTS , $LL [ 0 ]                ) ;
      }                                                                      ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $LINES        = array                (                                   ) ;
  if                                   ( count ( $LISTS ) > 0              ) {
    //////////////////////////////////////////////////////////////////////////
    $TITLE      = "<tr>"                                                     .
                  "<td colspan=2 id='AccountTitle'>"                         .
                  "Accounts"                                                 .
                  "</td>"                                                    .
                  "</tr>"                                                    ;
    $SPACE      = "<tr><td colspan=2>&nbsp;</td></tr>"                       ;
    //////////////////////////////////////////////////////////////////////////
    array_push                         ( $LINES , $TITLE                   ) ;
    array_push                         ( $LINES , $SPACE                   ) ;
    //////////////////////////////////////////////////////////////////////////
    foreach                            ( $LISTS as $L                      ) {
      $JSC      = "DeleteHtUser('{$L}');"                                    ;
      $ATDX     = "<td class='AccountCell'>{$L}</td>"                        ;
      $IMGC     = ""                                                         ;
      if                               ( $canDelete                        ) {
        $IMGX   = "<i class='fas fa-trash'></i>"                             ;
        $IMGC   = "<button"                                                  .
                  " class='btn-sm btn-warning'"                              .
                  " onclick=\"{$JSC}\">{$IMGX}</button>"                     ;
      }                                                                      ;
      $ATIM     = "<td"                                                      .
                  " nowrap='nowrap'"                                         .
                  " width='1%'"                                              .
                  " class='AccountCell'>"                                    .
                  "{$IMGC}"                                                  .
                  "</td>"                                                    ;
      $LINE     = "<tr>\n{$ATIM}\n{$ATDX}\n</tr>"                            ;
      array_push                       ( $LINES , $LINE                    ) ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
    array_push                         ( $LINES , $SPACE                   ) ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(ACCOUNT-LISTINGS)"  => implode   ( "" , $LINES                      ) ,
    "$(PASSWORD-ID)"       => $ID                                            ,
    "$(PASSWORD-ROOT)"     => $HTPASSWD                                      ,
    "$(PASSWORD-FILE)"     => $FILE                                          ,
    "$(PASSWORD-LANGUAGE)" => $LANG                                          ,
    "$(PASSWORD-WIDTH)"    => $WIDTH                                         ,
    "$(PASSWORD-APPEND)"   => $APPEND                                        ,
    "$(PASSWORD-DELETE)"   => $DELETE                                        ,
    "$(DISPLAY-APPEND)"    => $DISPAPPEND                                    ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys    ( $HTPASSWD , $MAPS                 ) ;
}
//////////////////////////////////////////////////////////////////////////////
// -| HtPwdListings |-
//////////////////////////////////////////////////////////////////////////////
// +| AppendHtPassword |+
//////////////////////////////////////////////////////////////////////////////
public static function AppendHtPassword ( $DB                                ,
                                          $PICKDB                            ,
                                          $HH                                ,
                                          $AA                                ,
                                          $Options                         ) {
  ////////////////////////////////////////////////////////////////////////////
  $PROGRAM  = $Options [ "Configure" ] [ "htpasswd" ]                        ;
  $ID       = $HH -> Parameter ( "ID"                                      ) ;
  $HTPASSWD = $HH -> Parameter ( "Root"                                    ) ;
  $LANG     = $HH -> Parameter ( "Language"                                ) ;
  $FILE     = $HH -> Parameter ( "File"                                    ) ;
  $WIDTH    = $HH -> Parameter ( "Width"                                   ) ;
  $APPEND   = $HH -> Parameter ( "Append"                                  ) ;
  $DELETE   = $HH -> Parameter ( "Delete"                                  ) ;
  $ACCOUNT  = $HH -> Parameter ( "Account"                                 ) ;
  $PASSWD   = $HH -> Parameter ( "Password"                                ) ;
  $AGAIN    = $HH -> Parameter ( "Again"                                   ) ;
  ////////////////////////////////////////////////////////////////////////////
  $EXECHT   = "{$PROGRAM} -mb {$FILE} {$ACCOUNT} {$PASSWD}"                  ;
  exec                                 ( $EXECHT                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $HT       = self::HtPwdListings      ( $ID                                 ,
                                         $HTPASSWD                           ,
                                         $FILE                               ,
                                         $LANG                               ,
                                         $WIDTH                              ,
                                         $APPEND                             ,
                                         $DELETE                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Message" ] = $HT                                                    ;
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| AppendHtPassword |-
//////////////////////////////////////////////////////////////////////////////
// +| DeleteHtPassword |+
//////////////////////////////////////////////////////////////////////////////
public static function DeleteHtPassword ( $DB                                ,
                                          $PICKDB                            ,
                                          $HH                                ,
                                          $AA                                ,
                                          $Options                         ) {
  ////////////////////////////////////////////////////////////////////////////
  $PROGRAM  = $Options [ "Configure" ] [ "htpasswd" ]                        ;
  $ID       = $HH -> Parameter ( "ID"                                      ) ;
  $HTPASSWD = $HH -> Parameter ( "Root"                                    ) ;
  $LANG     = $HH -> Parameter ( "Language"                                ) ;
  $FILE     = $HH -> Parameter ( "File"                                    ) ;
  $WIDTH    = $HH -> Parameter ( "Width"                                   ) ;
  $APPEND   = $HH -> Parameter ( "Append"                                  ) ;
  $DELETE   = $HH -> Parameter ( "Delete"                                  ) ;
  $ACCOUNT  = $HH -> Parameter ( "Account"                                 ) ;
  $PASSWD   = $HH -> Parameter ( "Password"                                ) ;
  $AGAIN    = $HH -> Parameter ( "Again"                                   ) ;
  ////////////////////////////////////////////////////////////////////////////
  $EXECHT   = "{$PROGRAM} -D {$FILE} {$ACCOUNT}"                             ;
  exec                                 ( $EXECHT                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $HT       = self::HtPwdListings      ( $ID                                 ,
                                         $HTPASSWD                           ,
                                         $FILE                               ,
                                         $LANG                               ,
                                         $WIDTH                              ,
                                         $APPEND                             ,
                                         $DELETE                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Message" ] = $HT                                                    ;
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| DeleteHtPassword |-
//////////////////////////////////////////////////////////////////////////////
// +| HtPassword |+
// HtPassword
//////////////////////////////////////////////////////////////////////////////
public static function HtPassword      ( $args , $argv , $Options          ) {
  ////////////////////////////////////////////////////////////////////////////
  if                                   ( $args < 2                         ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $FILE        = $argv    [ 1           ]                                    ;
  $ROOT        = $Options [ "Wiki"      ]                                    ;
  $AITK        = $Options [ "Extension" ]                                    ;
  $FILE        = "{$ROOT}{$FILE}"                                            ;
  ////////////////////////////////////////////////////////////////////////////
  $LANG        = "zh-TW"                                                     ;
  $WIDTH       = "100%"                                                      ;
  $canAppend   = "Yes"                                                       ;
  $canDelete   = "Yes"                                                       ;
  ////////////////////////////////////////////////////////////////////////////
  if                                   ( $args > 2                         ) {
    $LANG      = $argv [ 2 ]                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                   ( $args > 3                         ) {
    $WIDTH     = $argv [ 3 ]                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                   ( $args > 4                         ) {
    $canAppend = $argv [ 4 ]                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                   ( $args > 5                         ) {
    $canDelete = $argv [ 5 ]                                                 ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options   [ "Templates"                                  ] ;
  $HTPASSWD    = $Templates [ "HtPassword::Directory"                      ] ;
  $HTPASSWD    = "{$AITK}/{$HTPASSWD}{$LANG}.html"                           ;
  $ID          = self::RandomString    ( "HtPassword-" , 20                ) ;
  $LST         = self::HtPwdListings   ( $ID                                 ,
                                         $HTPASSWD                           ,
                                         $FILE                               ,
                                         $LANG                               ,
                                         $WIDTH                              ,
                                         $canAppend                          ,
                                         $canDelete                        ) ;
  ////////////////////////////////////////////////////////////////////////////
  return "<div id='{$ID}'>{$LST}</div>"                                      ;
}
//////////////////////////////////////////////////////////////////////////////
// -| DoMinifier |-
// 對JS/CSS進行簡化
//////////////////////////////////////////////////////////////////////////////
public static function DoMinifier  ( $DB , $PICKDB , $HH , $AA , $Options  ) {
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Answer" ] = "No"                                                    ;
  ////////////////////////////////////////////////////////////////////////////
  $MSG       = ""                                                            ;
  $TYPE      = $HH -> Parameter    ( "Type"                                ) ;
  $CONTENT   = $HH -> Parameter    ( "Content"                             ) ;
  ////////////////////////////////////////////////////////////////////////////
  $TYPE      = strtolower          ( $TYPE                                 ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                           ( $TYPE                                 ) {
    //////////////////////////////////////////////////////////////////////////
    case "js"                                                                :
      $DOMX  = new Minify\JS       (                                       ) ;
      $DOMX -> add                 ( $CONTENT                              ) ;
      $MSG   = $DOMX -> minify     (                                       ) ;
    break                                                                    ;
    //////////////////////////////////////////////////////////////////////////
    case "css"                                                               :
      $DOMX  = new Minify\CSS      (                                       ) ;
      $DOMX -> add                 ( $CONTENT                              ) ;
      $MSG   = $DOMX -> minify     (                                       ) ;
    break                                                                    ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Message" ] = $MSG                                                   ;
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| DoMinifier |-
//////////////////////////////////////////////////////////////////////////////
// +| Minifier |+
// JS/CSS語法簡化器
//////////////////////////////////////////////////////////////////////////////
public static function Minifier      ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Id          = self::GetTag        ( "id"        , $argv                 ) ;
  $TYPE        = self::GetTag        ( "type"      , $argv                 ) ;
  $TYPE        = strtolower          ( $TYPE                               ) ;
  $MIME        = ""                                                          ;
  $Label       = "Update"                                                    ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options            [ "Templates"                         ] ;
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Id ) <= 0                 ) {
    $Id        = self::RandomString  ( "File-" , 24                        ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $EXTENSION   = $Options            [ "AITK"                              ] ;
  $PATHX       = $Options            [ "Extension"                         ] ;
  $TEMPLFILE   = $Templates          [ "Minifier::Editor"                  ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $PARAMETERS  = array               (                                     ) ;
  $KEYs        = array_keys          ( $argv                               ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                            ( $KEYs as $K                         ) {
    //////////////////////////////////////////////////////////////////////////
    $S         = strtolower          ( $K                                  ) ;
    //////////////////////////////////////////////////////////////////////////
    switch                           ( $S                                  ) {
      case "function"                                                        :
      case "id"                                                              :
      case "type"                                                            :
      break                                                                  ;
      case "label"                                                           :
        $Label = self::GetTag        ( $K , $argv                          ) ;
      break                                                                  ;
      default                                                                :
        $V     = self::GetTag        ( $K , $argv                          ) ;
        array_push                   ( $PARAMETERS , "{$K}='{$V}'"         ) ;
      break                                                                  ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARMS       = ""                                                          ;
  if                                 ( count ( $PARAMETERS ) > 0           ) {
    $PARMS     = implode             ( " " , $PARAMETERS                   ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  switch                             ( $TYPE                               ) {
    case "js"                                                                :
      $MIME    = "application/javascript"                                    ;
    break                                                                    ;
    case "css"                                                               :
      $MIME    = "text/css"                                                  ;
    break                                                                    ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(EDITOR-ID)"           =>   $Id                                        ,
    "$(BUTTON-LABEL)"        =>   $Label                                     ,
    "$(EDITOR-PARAMETERS)"   =>   $PARMS                                     ,
    "$(MINIFIER-TYPE)"       =>   $TYPE                                      ,
    "$(MINIFIER-MIME)"       =>   $MIME                                      ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys  ( $TEMPLFILE , $MAPS                  ) ;
}
//////////////////////////////////////////////////////////////////////////////
// -| Minifier |-
//////////////////////////////////////////////////////////////////////////////
// +| ReadParagraph |+
// 讀取檔案
//////////////////////////////////////////////////////////////////////////////
public static function ReadParagraph  ( $DB                                  ,
                                        $PICKDB                              ,
                                        $HH                                  ,
                                        $AA                                  ,
                                        $Options                           ) {
  ////////////////////////////////////////////////////////////////////////////
  $DELIMITER = $HH -> Parameter       ( "Delimiter"                        ) ;
  $PARAGRAPH = $HH -> Parameter       ( "Paragraph"                        ) ;
  $FILENAME  = $HH -> Parameter       ( "Filename"                         ) ;
  $TEXT      = file_get_contents      ( $FILENAME                          ) ;
  if                                  ( ! $TEXT                            ) {
    $TEXT    = ""                                                            ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $TOP       = "{$DELIMITER} +| {$PARAGRAPH} |+"                             ;
  $LTOP      = strlen                 ( $TOP                               ) ;
  ////////////////////////////////////////////////////////////////////////////
  $BOTTOM    = "{$DELIMITER} -| {$PARAGRAPH} |-"                             ;
  $LBOTTOM   = strlen                 ( $BOTTOM                            ) ;
  ////////////////////////////////////////////////////////////////////////////
  $MATCHED   = false                                                         ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMs     = explode                ( "\n" , $TEXT                       ) ;
  $LINES     = array                  (                                    ) ;
  foreach                             ( $ITEMs as $L                       ) {
    //////////////////////////////////////////////////////////////////////////
    $FTOP    = substr                 ( $L , 0 , $LTOP                     ) ;
    $FBOTTOM = substr                 ( $L , 0 , $LBOTTOM                  ) ;
    //////////////////////////////////////////////////////////////////////////
    if                                ( $FTOP    == $TOP                   ) {
      $MATCHED = true                                                        ;
    } else
    if                                ( $FBOTTOM == $BOTTOM                ) {
      $MATCHED = false                                                       ;
    } else                                                                   {
      if                              ( $MATCHED                           ) {
        array_push                    ( $LINES , $L                        ) ;
      }                                                                      ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Message" ] = implode         ( "\n" , $LINES                      ) ;
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| ReadParagraph |-
//////////////////////////////////////////////////////////////////////////////
// +| WriteParagraph |+
// 寫入段落
//////////////////////////////////////////////////////////////////////////////
public static function WriteParagraph ( $DB                                  ,
                                        $PICKDB                              ,
                                        $HH                                  ,
                                        $AA                                  ,
                                        $Options                           ) {
  ////////////////////////////////////////////////////////////////////////////
  $PART      = $HH -> Parameter       ( "Text"                             ) ;
  $DELIMITER = $HH -> Parameter       ( "Delimiter"                        ) ;
  $PARAGRAPH = $HH -> Parameter       ( "Paragraph"                        ) ;
  $FILENAME  = $HH -> Parameter       ( "Filename"                         ) ;
  $TEXT      = file_get_contents      ( $FILENAME                          ) ;
  if                                  ( ! $TEXT                            ) {
    $TEXT    = ""                                                            ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $TZ        = $Options               [ "Configure" ] [ "timezone" ]         ;
  $NOW       = new StarDate           (                                    ) ;
  $NOW      -> Now                    (                                    ) ;
  $TODAY     = $NOW -> toDateTimeString ( $TZ , "T" , "Y-m-d" , "H:i:s"    ) ;
  ////////////////////////////////////////////////////////////////////////////
  $TOP       = "{$DELIMITER} +| {$PARAGRAPH} |+"                             ;
  $RTOP      = "{$TOP} Begin - {$TODAY}"                                     ;
  $LTOP      = strlen                 ( $TOP                               ) ;
  ////////////////////////////////////////////////////////////////////////////
  $BOTTOM    = "{$DELIMITER} -| {$PARAGRAPH} |-"                             ;
  $RBOTTOM   = "{$BOTTOM} Final - {$TODAY}"                                  ;
  $LBOTTOM   = strlen                 ( $BOTTOM                            ) ;
  ////////////////////////////////////////////////////////////////////////////
  $MATCHED   = false                                                         ;
  ////////////////////////////////////////////////////////////////////////////
  $ITEMs     = explode                ( "\n" , $TEXT                       ) ;
  $LINES     = array                  (                                    ) ;
  foreach                             ( $ITEMs as $L                       ) {
    //////////////////////////////////////////////////////////////////////////
    $FTOP    = substr                 ( $L , 0 , $LTOP                     ) ;
    $FBOTTOM = substr                 ( $L , 0 , $LBOTTOM                  ) ;
    //////////////////////////////////////////////////////////////////////////
    if                                ( $FTOP    == $TOP                   ) {
      $MATCHED = true                                                        ;
      array_push                      ( $LINES , $RTOP                     ) ;
      array_push                      ( $LINES , $PART                     ) ;
    } else
    if                                ( $FBOTTOM == $BOTTOM                ) {
      $MATCHED = false                                                       ;
      array_push                      ( $LINES , $RBOTTOM                  ) ;
    } else                                                                   {
      if                              ( ! $MATCHED                         ) {
        array_push                    ( $LINES , $L                        ) ;
      }                                                                      ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $CONTENT   = implode                ( "\n" , $LINES                      ) ;
  ////////////////////////////////////////////////////////////////////////////
  $fhandle   = fopen                  ( $FILENAME , "w+"                   ) ;
  fwrite                              ( $fhandle  , $CONTENT               ) ;
  fclose                              ( $fhandle                           ) ;
  ////////////////////////////////////////////////////////////////////////////
  $AA [ "Answer"  ] = "Yes"                                                  ;
  ////////////////////////////////////////////////////////////////////////////
  return $AA                                                                 ;
}
//////////////////////////////////////////////////////////////////////////////
// -| WriteParagraph |-
//////////////////////////////////////////////////////////////////////////////
// +| ParagraphUI |+
// 段落編輯器
//////////////////////////////////////////////////////////////////////////////
public static function ParagraphUI   ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Id          = self::GetTag        ( "id"        , $argv                 ) ;
  $Filename    = self::GetTag        ( "filename"  , $argv                 ) ;
  $Directory   = self::GetTag        ( "directory" , $argv                 ) ;
  $Delimiter   = self::GetTag        ( "delimiter" , $argv                 ) ;
  $Paragraph   = self::GetTag        ( "paragraph" , $argv                 ) ;
  $Original    = $Filename                                                   ;
  $Label       = "Update"                                                    ;
  ////////////////////////////////////////////////////////////////////////////
  $Templates   = $Options            [ "Templates"                         ] ;
  $DIRs        = $Options            [ "Directory"                         ] ;
  ////////////////////////////////////////////////////////////////////////////
  if ( ! array_key_exists ( $Directory , $DIRs ) )                           {
    $Directory = "Default"                                                   ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $DIRPATH     = $DIRs               [ $Directory                          ] ;
  $LOCALFILE   = "{$DIRPATH}/{$Filename}"                                    ;
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Content ) > 0             ) {
    $Original  = $Content                                                    ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                                 ( strlen ( $Id ) <= 0                 ) {
    $Id        = self::RandomString  ( "File-" , 24                        ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $EXTENSION   = $Options            [ "AITK"                              ] ;
  $PATHX       = $Options            [ "Extension"                         ] ;
  $TEMPLFILE   = $Templates          [ "Paragraph::Editor"                 ] ;
  $TEMPLFILE   = "{$PATHX}/{$TEMPLFILE}"                                     ;
  ////////////////////////////////////////////////////////////////////////////
  $READONLY    = ""                                                          ;
  $PARAMETERS  = array               (                                     ) ;
  $KEYs        = array_keys          ( $argv                               ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                            ( $KEYs as $K                         ) {
    //////////////////////////////////////////////////////////////////////////
    $S         = strtolower          ( $K                                  ) ;
    //////////////////////////////////////////////////////////////////////////
    switch                           ( $S                                  ) {
      case "function"                                                        :
      case "id"                                                              :
      case "filename"                                                        :
      case "directory"                                                       :
      break                                                                  ;
      case "label"                                                           :
        $Label = self::GetTag        ( $K , $argv                          ) ;
      break                                                                  ;
      case "readonly"                                                        :
        $RO    = self::GetTag        ( $K , $argv                          ) ;
        $RO    = strtolower          ( $RO                                 ) ;
        if ( ( strlen ( $RO ) <= 0 )                                        ||
             ( in_array ( $RO , [ "true" , "yes" ] ) )                     ) {
          $READONLY = "display: none;"                                       ;
        }                                                                    ;
      default                                                                :
        $V     = self::GetTag        ( $K , $argv                          ) ;
        array_push                   ( $PARAMETERS , "{$K}='{$V}'"         ) ;
      break                                                                  ;
    }                                                                        ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PARMS       = ""                                                          ;
  if                                 ( count ( $PARAMETERS ) > 0           ) {
    $PARMS     = implode             ( " " , $PARAMETERS                   ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $MAPS        = array                                                       (
    "$(EDITOR-ID)"           =>   $Id                                        ,
    "$(BUTTON-LABEL)"        =>   $Label                                     ,
    "$(EDITOR-LABEL)"        =>   $Original                                  ,
    "$(EDITOR-PARAMETERS)"   =>   $PARMS                                     ,
    "$(EDITOR-DIRECTORY)"    =>   $Directory                                 ,
    "$(EDITOR-PATH)"         =>   $DIRPATH                                   ,
    "$(EDITOR-FILENAME)"     =>   $Filename                                  ,
    "$(EDITOR-LOCALFILE)"    =>   $LOCALFILE                                 ,
    "$(EDITOR-READONLY)"     =>   $READONLY                                  ,
    "$(EDITOR-DELIMITER)"    =>   $Delimiter                                 ,
    "$(EDITOR-PARAGRAPH)"    =>   $Paragraph                                 ,
  )                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return Strings::ReplaceFileByKeys  ( $TEMPLFILE , $MAPS                  ) ;
}
//////////////////////////////////////////////////////////////////////////////
// -| ParagraphUI |-
//////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
?>
