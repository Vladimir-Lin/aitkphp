<?php
//////////////////////////////////////////////////////////////////////////////
// AITK維基專用元件
//////////////////////////////////////////////////////////////////////////////
namespace AITK                                                               ;
//////////////////////////////////////////////////////////////////////////////
class Wiki                                                                   {
//////////////////////////////////////////////////////////////////////////////
// 取得關鍵字內容
//////////////////////////////////////////////////////////////////////////////
public static function GetTag ( $KEY , $TAGs                               ) {
  ////////////////////////////////////////////////////////////////////////////
  $K     = array_keys         ( $TAGs                                      ) ;
  $M     = strtolower         ( $KEY                                       ) ;
  foreach                     ( $K as $L                                   ) {
    $S   = strtolower         ( $L                                         ) ;
    if                        ( $S == $M                                   ) {
      return $TAGs [ $L ]                                                    ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return ""                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 取得函數
//////////////////////////////////////////////////////////////////////////////
public static function GetFunction ( $argv , $Maps                         ) {
  ////////////////////////////////////////////////////////////////////////////
  $func = self::GetTag             ( "function" , $argv                    ) ;
  if                               ( strlen ( $func ) <= 0                 ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                               ( ! array_key_exists ( $func , $Maps )  ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return $Maps [ $func ]                                                     ;
}
//////////////////////////////////////////////////////////////////////////////
// 錯誤參數
//////////////////////////////////////////////////////////////////////////////
public static function GetVariables ( $args , $argv , $Options             ) {
  ////////////////////////////////////////////////////////////////////////////
  if                                ( $args < 2                            ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $KEY         = $argv [ 1 ]                                                 ;
  $KEY         = strtolower         ( $KEY                                 ) ;
  ////////////////////////////////////////////////////////////////////////////
  switch                            ( $KEY                                 ) {
    //////////////////////////////////////////////////////////////////////////
    case "options"                                                           :
    return json_encode              ( $Options                             ) ;
    //////////////////////////////////////////////////////////////////////////
    case "site"                                                              :
      $IDX     = 2                                                           ;
      $OPT     = $Options                                                    ;
      while                         ( $IDX < $args                         ) {
        $K     = $argv [ $IDX ]                                              ;
        if                          ( is_array ( $OPT )                    ) {
          if                        ( ! array_key_exists ( $K , $OPT )     ) {
            return ""                                                        ;
          }                                                                  ;
        } else                                                               {
          return ""                                                          ;
        }                                                                    ;
        $OPT   = $OPT [ $K ]                                                 ;
        $IDX   = $IDX + 1                                                    ;
      }                                                                      ;
      if                            ( is_array ( $OPT )                    ) {
        return json_encode          ( $OPT                                 ) ;
      }                                                                      ;
    return $OPT                                                              ;
    //////////////////////////////////////////////////////////////////////////
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return ""                                                                  ;
}
//////////////////////////////////////////////////////////////////////////////
// 錯誤參數
//////////////////////////////////////////////////////////////////////////////
public static function InvalidOptions ( $argv , $Content , $Options        ) {
  ////////////////////////////////////////////////////////////////////////////
  $JSOX = json_encode                 ( $argv                              ) ;
  return "Invalid parameters : [ {$JSOX} ] - | {$Content} |"                 ;
}
//////////////////////////////////////////////////////////////////////////////
// 輸出XML
//////////////////////////////////////////////////////////////////////////////
public static function ExportXML  ( $argv , $Content , $Options            ) {
  ////////////////////////////////////////////////////////////////////////////
  return $Content                                                            ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 輸出HTML
//////////////////////////////////////////////////////////////////////////////
public static function ExportHTML ( $argv , $Content , $Options            ) {
  ////////////////////////////////////////////////////////////////////////////
  $TAG          = ""                                                         ;
  $PARAMETERS   = ""                                                         ;
  $NOTAIL       = 0                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $C            = array           (                                        ) ;
  $K            = array_keys      ( $argv                                  ) ;
  ////////////////////////////////////////////////////////////////////////////
  foreach                         ( $K as $L                               ) {
    $S          = strtolower      ( $L                                     ) ;
    if                            ( $S == "function"                       ) {
    } else
    if                            ( $S == "tag"                            ) {
      $TAG      = $argv [ $L ]                                               ;
    } else
    if                            ( $S == "notail"                         ) {
      $V        = $argv [ $L ]                                               ;
      if                          ( strlen ( $V ) <= 0                     ) {
        $NOTAIL = 1                                                          ;
      } else                                                                 {
        $NOTAIL = $V                                                         ;
      }                                                                      ;
    } else                                                                   {
      $V        = $argv [ $L ]                                               ;
      $P        = "{$L}=\"{$V}\""                                            ;
      array_push                  ( $C , $P                                ) ;
    }                                                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                              ( count ( $C ) > 0                       ) {
    $PARAMETERS = implode         ( " " , $C                               ) ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                              ( strlen ( $TAG ) <= 0                   ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  if                              ( $NOTAIL > 0                            ) {
    return "<{$TAG} {$PARAMETERS} />"                                        ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  return   "<{$TAG} {$PARAMETERS}>{$Content}</{$TAG}>"                       ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 輸出JSON
//////////////////////////////////////////////////////////////////////////////
public static function ExportJSON ( $argv , $Content , $Options            ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode              ( $argv                                  ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 輸出設定值
//////////////////////////////////////////////////////////////////////////////
public static function ExportOptions ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  return json_encode                 ( $Options                            ) ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
// 引入模組
//////////////////////////////////////////////////////////////////////////////
public static function IncludeModule ( $argv , $Content , $Options         ) {
  ////////////////////////////////////////////////////////////////////////////
  $Module = self::GetTag             ( "name" , $argv                      ) ;
  if ( ! array_key_exists ( "Modules" , $Options )                         ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $PATHs  = $Options [ "Modules" ]                                           ;
  if ( ! array_key_exists ( $Module , $PATHs )                             ) {
    return ""                                                                ;
  }                                                                          ;
  ////////////////////////////////////////////////////////////////////////////
  $EXTENSION = $Options [ "AITK"      ]                                      ;
  $PATHX     = $Options [ "Extension" ]                                      ;
  $FILENAME  = $PATHs   [ $Module     ]                                      ;
  $FILENAME  = "{$PATHX}/{$FILENAME}"                                        ;
  ////////////////////////////////////////////////////////////////////////////
  $TEMPL     = file_get_contents ( $FILENAME )                               ;
  $TEMPL     = str_replace ( "$(EXTENSION-PATH)" , $EXTENSION , $TEMPL )     ;
  ////////////////////////////////////////////////////////////////////////////
  return $TEMPL                                                              ;
  ////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////
?>
